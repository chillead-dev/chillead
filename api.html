<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>api</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="referrer" content="no-referrer" />
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self';
                 img-src 'self' https: data:;
                 style-src 'self' 'unsafe-inline';
                 script-src 'self' 'unsafe-inline';
                 connect-src 'self';
                 base-uri 'none';
                 frame-ancestors 'none';">

  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <div class="wrap">
    <header class="header">
      <h1 class="cute-h1"># api</h1>
      <div class="sub">docs + status · <span id="apiStatus">checking…</span></div>
    </header>

    <section class="section">
      <h2 class="cute-h2">## overview</h2>
      <div class="panel">
        <pre class="about-text">base url:
- https://hatesocial.lol

public endpoints (safe):
- GET  /api/health
- GET  /api/letters/list
- POST /api/letters/submit
- GET  /api/now-playing

private endpoints (owner only):
- GET  /api/letters/pending
- POST /api/letters/approve
- POST /api/letters/answer

security notes:
- admin token must NEVER be used on client-side
- this page does NOT call private endpoints
- public endpoints do not expose redis tokens or raw db</pre>
      </div>
    </section>

    <section class="section">
      <h2 class="cute-h2">## usage</h2>
      <div class="panel">
        <pre class="about-text">submit:
POST /api/letters/submit
Content-Type: application/json

{ "message": "hello!" }

list:
GET /api/letters/list

response:
{
  "ok": true,
  "items": [
    {
      "id": "...",
      "message": "...",
      "createdAt": 1730000000000,
      "answered": true,
      "answer": "..."
    }
  ]
}</pre>
      </div>
    </section>

    <section class="section">
      <h2 class="cute-h2">## live status</h2>
      <div class="panel">
        <pre id="checks" class="about-text">checking…</pre>
      </div>
    </section>

    <footer class="footer">
      <a href="/">home</a><span class="sep">·</span><a href="/404.html">404</a>
    </footer>
  </div>

  <script>
    async function check(url){
      try{
        const r = await fetch(url, { cache:"no-store" });
        const j = await r.json().catch(()=>null);
        return { status:r.status, json:j };
      }catch{
        return { status:0, json:null };
      }
    }

    (async()=>{
      const h = await check("/api/health");
      const l = await check("/api/letters/list");
      const s = await check("/api/now-playing");

      const online = h.json && h.json.ok;
      document.getElementById("apiStatus").textContent = online ? "online" : "offline";

      document.getElementById("checks").textContent =
`/api/health       -> ${h.status}
 /api/letters/list -> ${l.status}
 /api/now-playing  -> ${s.status}

safe:
- no private endpoints requested here
- no admin token required for this page`;
    })();
  </script>
</body>
</html>
