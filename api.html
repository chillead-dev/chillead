<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>API</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <div class="wrap">
    <div class="header">
      <h1># api</h1>
      <div class="sub">letterbox api docs · status: <span id="apiStatus">checking…</span></div>
    </div>

    <div class="panel">
      <pre class="spotify-pre">
base url:
  https://hatesocial.lol

public endpoints:
  GET  /api/letters/list
  POST /api/letters/submit

admin endpoints (require Authorization: Bearer ADMIN_TOKEN):
  GET  /api/letters/pending
  POST /api/letters/approve
  POST /api/letters/answer

health:
  GET /api/health
      </pre>
    </div>

    <div class="section">
      <h2>## examples</h2>
      <div class="panel">
        <pre class="spotify-pre">
# submit
fetch("/api/letters/submit",{
  method:"POST",
  headers:{ "Content-Type":"application/json" },
  body: JSON.stringify({ message:"hello" })
})

# list
fetch("/api/letters/list").then(r=>r.json()).then(console.log)
        </pre>
      </div>
    </div>

    <div class="section">
      <h2>## live checks</h2>
      <div class="panel">
        <pre id="checks" class="spotify-pre">checking…</pre>
      </div>
    </div>

    <div class="footer">
      <a href="/">home</a>
    </div>
  </div>

  <script>
    async function check(url, opts){
      try{
        const r = await fetch(url, { cache:"no-store", ...(opts||{}) });
        const j = await r.json().catch(()=>null);
        return { ok: r.ok, status: r.status, json: j };
      }catch(e){
        return { ok:false, status:0, json:null };
      }
    }

    (async ()=>{
      const health = await check("/api/health");
      document.getElementById("apiStatus").textContent =
        (health.ok && health.json && health.json.ok) ? "online" : "offline";

      const list = await check("/api/letters/list");
      const nowp = await check("/api/now-playing");

      const out =
`/api/health: ${health.status}
 /api/letters/list: ${list.status}
 /api/now-playing: ${nowp.status}

notes:
- admin endpoints require Authorization header
- submit is moderated (pending -> approve -> public)
`;
      document.getElementById("checks").textContent = out;
    })();
  </script>
</body>
</html>
