<script>
const playerBox = document.getElementById("player");

async function loadNowPlaying() {
  playerBox.textContent = "loading track data...";

  try {
    const res = await fetch("/api/now-playing", {
      cache: "no-store",
    });

    if (!res.ok) {
      playerBox.textContent = "failed to load track data.";
      return;
    }

    const data = await res.json();

    if (!data || !data.playing) {
      playerBox.textContent = "nothing is currently playing.";
      return;
    }

    const percent = Math.min(
      100,
      Math.max(2, (data.progress / data.duration) * 100)
    );

    playerBox.innerHTML = `
      <b>${data.title}</b>
      <div class="muted">${data.artist}</div>
      <div class="bar">
        <div class="fill" style="width:${percent}%"></div>
      </div>
    `;
  } catch (e) {
    console.error(e);
    playerBox.textContent = "error loading track data.";
  }
}

loadNowPlaying();
setInterval(loadNowPlaying, 15000);
</script>
