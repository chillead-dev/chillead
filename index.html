<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>alex</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<main class="page">

  <section class="block">
    <h1># welcome!</h1>

    <p>
      hello! my name is <strong>alex</strong>.
      i'm a developer focused on creating useful things:
      websites, bots and tools that save time.
    </p>
  </section>

  <section class="block">
    <h2>## about</h2>
    <ul class="list">
      <li><span>name:</span> alex</li>
      <li><span>alive for:</span> <span id="alive"></span></li>
      <li><span>languages:</span> EN, RU</li>
      <li><span>location:</span> Ekaterinburg, RU (<span id="time"></span>)</li>
      <li><span>occupation:</span> websites ¬∑ bots ¬∑ parsers</li>
    </ul>
  </section>

  <section class="block">
    <h2>## background</h2>
    <p>
      started coding in 2021 at 11 years old.
      first language was <strong>c++</strong>.
    </p>
  </section>

  <section class="block">
    <h2>## skills</h2>
    <ul class="list compact">
      <li>c++, javascript, typescript</li>
      <li>backend & websites</li>
      <li>telegram bots</li>
      <li>cats üêà</li>
    </ul>
  </section>

  <section class="block">
    <h2>## currently playing</h2>

    <div class="spotify-card" id="player">
      loading track data...
    </div>
  </section>

</main>

<script>
/* alive counter */
const birth = new Date("2010-08-05T00:00:00Z");
function updateAlive() {
  let diff = Math.floor((Date.now() - birth) / 1000);
  const y = Math.floor(diff / 31557600);
  diff -= y * 31557600;
  const d = Math.floor(diff / 86400);
  diff -= d * 86400;
  const h = Math.floor(diff / 3600);
  diff -= h * 3600;
  const m = Math.floor(diff / 60);
  const s = diff % 60;
  document.getElementById("alive").textContent =
    `${d + y * 365}d ${h}h ${m}m ${s}s`;
}
updateAlive();
setInterval(updateAlive, 1000);

/* local time */
function updateTime() {
  document.getElementById("time").textContent =
    new Intl.DateTimeFormat("en-GB", {
      timeZone: "Asia/Yekaterinburg",
      hour: "2-digit",
      minute: "2-digit",
      second: "2-digit"
    }).format(new Date());
}
updateTime();
setInterval(updateTime, 1000);

/* spotify now playing */
const player = document.getElementById("player");

async function loadNowPlaying() {
  try {
    const res = await fetch("/api/now-playing", { cache: "no-store" });
    const data = await res.json();

    if (!data || !data.playing) {
      player.textContent = "nothing is currently playing.";
      return;
    }

    const percent = Math.min(
      100,
      Math.max(2, (data.progress / data.duration) * 100)
    );

    player.innerHTML = `
<div class="track">
  <img class="cover" src="${data.cover}" alt="cover">
  <div class="track-info">
    <div class="track-title">${data.title}</div>
    <div class="track-artist">${data.artist}</div>
    <div class="progress">
      <div class="progress-fill" style="width:${percent}%"></div>
    </div>
  </div>
</div>
`;
  } catch {
    player.textContent = "failed to load track data.";
  }
}

loadNowPlaying();
setInterval(loadNowPlaying, 15000);
</script>

</body>
</html>
